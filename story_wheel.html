<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Story Starter Wheel V8.0 - Writer Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* --- GENERAL STYLES --- */
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LEFT SIDEBAR (SCENE REFERENCE) --- */
        .sidebar {
            width: 30%;
            background-color: #f9f9f9;
            border-right: 2px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            box-shadow: inset -5px 0 10px -5px rgba(0,0,0,0.1);
        }
        .sidebar h2 { color: #333; margin-top: 0; border-bottom: 2px solid #0056b3; padding-bottom: 10px;}
        .scene-card { background: #fff; border-left: 5px solid #0056b3; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .scene-title { font-weight: bold; font-size: 16px; color: #0056b3; margin-bottom: 8px; }
        .scene-text { font-size: 13px; color: #444; line-height: 1.4; font-style: italic;}


        /* --- MAIN CONTENT AREA --- */
        .main-content {
            flex: 1;
            display: flex;
            background-color: #ffffff;
            position: relative;
        }

        /* --- WHEEL CONTAINER (LEFT HALF OF MAIN AREA) --- */
        .wheel-container {
            width: 50%; 
            min-width: 450px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #eee;
        }

        /* --- OUTPUT & EDITOR PANEL (RIGHT HALF OF MAIN AREA) --- */
        #right-panel {
            width: 50%;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow scrolling if text gets long */
        }

        /* Output Box Styles */
        .output-box {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        .output-box h3 { 
            color: #d9534f;
            margin-top: 0;
            font-size: 1.4em;
            border-bottom: 2px solid #d9534f;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .output-box strong { color: #0056b3; display: block; margin-bottom: 8px; font-size: 1.1em;}
        .output-suggestion {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 3px solid #eee;
        }

        /* Writing Window Styles */
        .editor-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .editor-title { font-weight: bold; color: #333; }
        
        textarea {
            width: 100%;
            flex-grow: 1; /* Fills remaining space */
            border: 1px solid #eee;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            resize: none; /* Disable manual resize, let flexbox handle it */
            outline: none;
            background-color: #fafafa;
            min-height: 200px;
        }
        textarea:focus { background-color: #fff; border-color: #0056b3; }

        .save-btn-group {
            display: flex;
            gap: 10px;
        }
        .btn-save {
            padding: 5px 10px;
            font-size: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-save:hover { background-color: #218838; }
        .btn-save.blue { background-color: #0056b3; }
        .btn-save.blue:hover { background-color: #004494; }
        .btn-save.red { background-color: #d9534f; }
        .btn-save.red:hover { background-color: #c9302c; }


        /* --- RINGS --- */
        .ring {
            position: absolute; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        /* No cursor grab styles anymore */
        
        #outer-ring { width: 450px; height: 450px; background-color: #0056b3; z-index: 1; }
        #inner-ring { width: 320px; height: 320px; background-color: #d9534f; z-index: 2; }

        /* TEXT ON RINGS */
        .ring-spoke { 
            position: absolute; 
            height: 50%; 
            top: 0; 
            left: 50%; 
            width: 0; 
            transform-origin: bottom center; 
            pointer-events: none; 
        }
        .text-label { 
            position: absolute; 
            top: 15px; 
            left: -75px; 
            width: 150px; 
            text-align: center; 
            color: white; 
            font-weight: bold; 
            font-size: 13px; 
            text-transform: uppercase; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.4); 
        }
        
        .arrow { position: absolute; top: 10px; z-index: 10; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 30px solid #333; }

        /* CONTROLS */
        .controls-area { margin-top: 480px; display: flex; gap: 20px; position: relative; z-index: 20;}
        .control-group { text-align: center; background: #f0f0f0; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
        .wheel-btn { padding: 8px 15px; font-size: 16px; cursor: pointer; background-color: #fff; border: 1px solid #999; border-radius: 4px; margin: 0 5px; box-shadow: 0 2px 2px rgba(0,0,0,0.1); }
        .wheel-btn:hover { background-color: #e2e6ea; }
        .lbl { font-size: 12px; font-weight: bold; margin-bottom: 5px; display: block; color: #333; text-transform: uppercase;}
        .lbl.blue { color: #0056b3; }
        .lbl.red { color: #d9534f; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Scene Reference Menu</h2>
        <p class="instructions">Use the buttons below the wheel to combine a scene number with a planning category.</p>

        <div class="scene-card"><div class="scene-title">SCENE 1 (Thriller)</div><div class="scene-text">A narrow ledge... Someone moves gingerly, back against the wall, eyes trying not to look down...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 2 (Western)</div><div class="scene-text">A western saloon. Piano tinkling. Cowhands drinking. A stranger appears at the swing door...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 3 (Horror)</div><div class="scene-text">A bedroom at night, full moon. A young girl sleeping. A figure appears beside her bed, leans over...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 4 (Sports)</div><div class="scene-text">A penalty shootout. Final kick. The player places the ball. Looks at the keeper. Begins his run...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 5 (Mystery)</div><div class="scene-text">Night. An old country house. A figure climbs ivy to a balcony. Flash of a blade, window prised open...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 6 (Crime)</div><div class="scene-text">Airport lockers. A man approaches furtively, opens a locker, removes a briefcase. From behind, a gun pressed into his ribs...</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 7 (Action)</div><div class="scene-text">Night. A figure crawls to a barbed wire fence. Whistles softly. Joined by a second figure. They begin to cut the wire.</div></div>
        <div class="scene-card"><div class="scene-title">SCENE 8 (Drama)</div><div class="scene-text">School yard at night. Caretaker doing rounds. Shadowy figures dodge and hide. They approach a window and prise it open...</div></div>
    </div>

    <div class="main-content">
        <div class="wheel-container">
            <div class="arrow"></div>

            <div id="outer-ring" class="ring"></div>
            <div id="inner-ring" class="ring"></div>
            
            <div class="controls-area">
                <div class="control-group">
                    <span class="lbl blue">Outer Ring</span>
                    <button class="wheel-btn" onclick="rotateRing('outer-ring', -45)">◀</button>
                    <button class="wheel-btn" onclick="rotateRing('outer-ring', 45)">▶</button>
                </div>
                <div class="control-group">
                    <span class="lbl red">Inner Ring</span>
                    <button class="wheel-btn" onclick="rotateRing('inner-ring', -60)">◀</button>
                    <button class="wheel-btn" onclick="rotateRing('inner-ring', 60)">▶</button>
                </div>
            </div>
        </div>

        <div id="right-panel">
            <div class="output-box">
                <h3 id="result-title">Welcome</h3>
                <div id="result-desc">
                    <p>Use the buttons to spin the wheels and generate a prompt.</p>
                </div>
            </div>

            <div class="editor-container">
                <div class="editor-header">
                    <span class="editor-title">Writing Window</span>
                    <div class="save-btn-group">
                        <button class="btn-save" onclick="saveText()">Save .TXT</button>
                        <button class="btn-save blue" onclick="saveWord()">Save .DOC</button>
                        <button class="btn-save red" onclick="savePDF()">Save .PDF</button>
                    </div>
                </div>
                <textarea id="story-editor" placeholder="Write your story idea here..."></textarea>
            </div>
        </div>
    </div>

    <script>
        // --- DATA CONFIGURATION ---

        var scenesData = [
            { label: "SCENE 1", group: 'A' },
            { label: "SCENE 2", group: 'B' },
            { label: "SCENE 3", group: 'C' },
            { label: "SCENE 4", group: 'C' },
            { label: "SCENE 5", group: 'A' },
            { label: "SCENE 6", group: 'B' },
            { label: "SCENE 7", group: 'A' },
            { label: "SCENE 8", group: 'A' }
        ];

        var planningCategories = [
            { label: "WHO?", full: "Character Archetype" },
            { label: "WHY?", full: "Motivation / Goal" },
            { label: "WHAT NEXT?", full: "Immediate Action" },
            { label: "SIGHT / SOUND", full: "Sensory Clues" },
            { label: "TOUCH / FEEL", full: "Physical State" },
            { label: "EMOTION", full: "Internal Conflict" }
        ];

        var suggestions = {
            'A': [ // Stealth/Intrusion 
                ["Character Archetype", "A determined agent, a scared thief, or a quiet runaway.", "A figure of authority, like a guard or caretaker."],
                ["Motivation / Goal", "Reach the objective unseen, retrieve a hidden item, or avoid capture.", "Escape, hide evidence, or protect secrets."],
                ["Immediate Action", "They freeze, they look over their shoulder, they take one slow step.", "A sudden noise, a beam of light, or the sound of breaking glass."],
                ["Sensory Clues", "The metallic click of the device, the slick feel of wet metal, or the smell of cold stone.", "The scratch of rough fabric, the silent movement of shadows, or a distant siren."],
                ["Physical State", "Hands trembling, heart hammering like a drum, or cold sweat on their back.", "The burning ache in tired muscles, a shaky grip, or the chill of the night air."],
                ["Internal Conflict", "Focused determination, paralyzing fear, or rising adrenaline.", "A desperate need to succeed, or deep regret for being there."]
            ],
            'B': [ // Confrontation/Meeting 
                ["Character Archetype", "A world-weary veteran, a rich but panicked target, or a calm, dangerous stranger.", "A person waiting for someone, or someone who has been betrayed."],
                ["Motivation / Goal", "Demand money/information, stand their ground against a threat, or maintain a facade of calm.", "To resolve a debt, to escape without drawing attention, or to complete a trade."],
                ["Immediate Action", "They slowly raise their hands, they whisper a direct threat, or they scan the room for an exit.", "A glass shatters, a sudden whisper, or a gun cocking."],
                ["Sensory Clues", "The sharp scent of old wood/dust, the metallic taste of fear, or the clinking sound of glasses/keys.", "The rough wool of a jacket, the cold press of metal, or the smell of cheap tobacco/perfume."],
                ["Physical State", "Dry mouth, heavy breathing, or a tremor in their hands.", "A cold knot of dread in the stomach, or the sudden warmth of adrenaline."],
                ["Internal Conflict", "A cold, calculated hatred, rising panic, or feigned indifference.", "Focus on who has the upper hand in the conversation."]
            ],
            'C': [ // High Stakes Moment 
                ["Character Archetype", "A small, vulnerable child, a seasoned hero, or an athlete under immense pressure.", "A person making a decision that will change their life forever."],
                ["Motivation / Goal", "Win the game, survive the moment, or protect the person they love.", "To deny the reality of the situation, or to focus only on the simple task ahead."],
                ["Immediate Action", "They close their eyes and count, they take one measured step, or they reach out a hand.", "The final whistle blows, a creaking floorboard, or the curtain lifts on the scene."],
                ["Sensory Clues", "The overwhelming noise of the crowd/silence of the room, the smell of fresh linen/wet grass.", "The scratch of the ball on the turf, the feel of a wooden floor, or the sound of wind outside."],
                ["Physical State", "Heartbeat filling their ears, numb hands/feet, or a lump forming in the throat.", "The heavy weight of expectation, or the lightness of sudden fear."],
                ["Internal Conflict", "Pure, focused determination, a blend of hope and terror, or profound loneliness.", "Focus on the pressure of time—is it moving fast or slow?"]
            ]
        };
        
        // --- WHEEL SETUP FUNCTIONS ---

        function setupRings() {
            var rings = [{ id: 'outer-ring', data: scenesData, step: 45 }, { id: 'inner-ring', data: planningCategories, step: 60 }];
            
            rings.forEach(function(ringData) {
                var ring = document.getElementById(ringData.id);
                var count = ringData.data.length;
                var angleStep = ringData.step;

                for (var i = 0; i < count; i++) {
                    var spoke = document.createElement('div');
                    spoke.className = 'ring-spoke';
                    var rotation = (i * angleStep) + (angleStep / 2);
                    spoke.style.transform = 'rotate(' + rotation + 'deg)';

                    var label = document.createElement('div');
                    label.className = 'text-label';
                    label.innerText = ringData.data[i].label;
                    
                    spoke.appendChild(label);
                    ring.appendChild(spoke);
                }
            });
        }
        setupRings();


        // --- INTERACTION LOGIC ---

        var rotations = { 'outer-ring': 0, 'inner-ring': 0 };
        
        // NOTE: Drag Logic has been removed as requested.

        // Helper to update rotation via button click
        function rotateRing(id, deg) {
            rotations[id] += deg;
            document.getElementById(id).style.transform = 'rotate(' + rotations[id] + 'deg)';
            updateCenter();
        }

        // Helper to get index of the item at the top (0 degrees)
        function getIndex(rotation, total) {
            var step = 360 / total;
            var angle = rotation % 360;
            if (angle < 0) angle += 360;
            var index = Math.round(((360 - angle) % 360) / step);
            return index;
        }

        // Main function to update the output panel
        function updateCenter() {
            var sceneIndex = getIndex(rotations['outer-ring'], scenesData.length);
            var categoryIndex = getIndex(rotations['inner-ring'], planningCategories.length);
            
            var activeScene = scenesData[sceneIndex];
            var activeCategory = planningCategories[categoryIndex];
            var groupKey = activeScene.group;
            
            var specificSuggestionsArray = suggestions[groupKey];
            var currentSuggestionSet = specificSuggestionsArray[categoryIndex];
            
            var mainTitle = currentSuggestionSet[0];
            
            var descHtml = "";
            for (var i = 1; i < currentSuggestionSet.length; i++) {
                descHtml += '<div class="output-suggestion">' + currentSuggestionSet[i] + '</div>';
            }
            
            document.getElementById('result-title').innerText = activeCategory.label;
            document.getElementById('result-desc').innerHTML = '<strong>' + mainTitle + '</strong>' + descHtml;
        }

        updateCenter();

        // --- SAVE FUNCTIONS ---

        function getContent() {
            var text = document.getElementById('story-editor').value;
            if(!text) {
                alert("Please write something in the Writing Window before saving.");
                return null;
            }
            return text;
        }

        function saveText() {
            var text = getContent();
            if(!text) return;
            var blob = new Blob([text], { type: "text/plain;charset=utf-8" });
            var anchor = document.createElement("a");
            anchor.href = URL.createObjectURL(blob);
            anchor.download = "story-starter.txt";
            anchor.click();
        }

        function saveWord() {
            var text = getContent();
            if(!text) return;
            // Add simple HTML wrapper to preserve line breaks for Word
            var htmlContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"></head><body>' + text.replace(/\n/g, "<br>") + '</body></html>';
            var blob = new Blob([htmlContent], { type: "application/msword" });
            var anchor = document.createElement("a");
            anchor.href = URL.createObjectURL(blob);
            anchor.download = "story-starter.doc";
            anchor.click();
        }

        function savePDF() {
            var text = getContent();
            if(!text) return;
            
            // Access jsPDF from global window object
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Split text to fit page width (A4 width is approx 210mm, margin 10mm -> 190mm)
            var splitText = doc.splitTextToSize(text, 180);
            
            // Add text to PDF
            doc.text(splitText, 10, 10);
            doc.save("story-starter.pdf");
        }

    </script>
</body>
</html>
