<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Recovery Tool</title>
    <style>
        body { font-family: sans-serif; padding: 40px; text-align: center; background: #f4f6f7; }
        .box { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; }
        h1 { color: #e74c3c; }
        .btn { background: #2ecc71; color: white; border: none; padding: 15px 30px; font-size: 1.2rem; border-radius: 5px; cursor: pointer; margin-top: 20px; }
        .btn:hover { background: #27ae60; }
        ul { text-align: left; background: #eee; padding: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="box">
        <h1>Evaluation Architect Data Recovery</h1>
        <p>I am scanning your browser for saved data from previous versions...</p>
        
        <ul id="log">Scanning...</ul>
        
        <button class="btn" onclick="downloadBackup()">Download All Found Data</button>
    </div>

    <script>
        // List of all keys we have used in previous versions
        var knownKeys = [
            'eval_arch_v81_critical',
            'eval_arch_v82_full',
            'eval_arch_v83_full',
            'eval_arch_v84_specifics',
            'eval_arch_v85_sandbox',
            'eval_arch_v86_stable',
            'eval_arch_v87_revised',
            'eval_arch_v88_review',
            'eval_arch_v89_review',
            'eval_arch_v91_stable',
            'eval_arch_v92_reset',
            'eval_arch_v93_complete',
            'eval_arch_v94_complete',
            'eval_arch_v95_levels',
            'eval_arch_v96_modes',
            'eval_arch_v97_banks',
            'eval_arch_v97_full',
            'eval_arch_v99_cleaner'
        ];

        var recoveredData = null;

        window.onload = function() {
            var log = document.getElementById('log');
            log.innerHTML = "";
            var found = false;
            
            // Search local storage
            knownKeys.forEach(key => {
                var data = localStorage.getItem(key);
                if(data) {
                    found = true;
                    var parsed = JSON.parse(data);
                    var count = parsed.content_pairs ? parsed.content_pairs.length : 0;
                    log.innerHTML += `<li>✅ Found <strong>${key}</strong> (${count} questions)</li>`;
                    // We take the most recent/complex one as the master
                    recoveredData = parsed; 
                }
            });

            if(!found) {
                log.innerHTML = "<li>❌ No previous data found in this browser.</li>";
            } else {
                log.innerHTML += "<li style='color:green; margin-top:10px;'><strong>Ready to download!</strong></li>";
            }
        };

        function downloadBackup() {
            if(!recoveredData) return alert("No data to save.");
            var blob = new Blob([JSON.stringify(recoveredData)], {type: "application/json"});
            var url = URL.createObjectURL(blob);
            var a = document.createElement("a");
            a.href = url;
            a.download = "evaluation_architect_RECOVERED.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
