<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Architect</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script>
        window.onerror = function(msg, url, line, col, error) {
            var trap = document.getElementById('error-trap');
            if(trap) {
                trap.style.display = 'flex';
                document.getElementById('error-msg').innerText = msg + "\nLine: " + line;
            }
            return false;
        };
    </script>

    <style>
        :root {
            --col-1-pink: #ff99cc; --col-2-yellow: #ffeb3b; --col-3-blue: #85c1e9; --col-4-green: #90ee90;
            --app-color: #2c3e50; --accent-color: #e74c3c;
            --level-1: #3498db; --level-2: #2ecc71; --level-3: #9b59b6;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f7; color: #333; margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* ERROR SCREEN */
        #error-trap {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(231, 76, 60, 0.95); color: white; z-index: 999999;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
        h1 { margin: 0; color: var(--app-color); font-size: 1.6rem; }
        #score-board { background: var(--app-color); color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; display: flex; gap: 10px; align-items: center; }
        .level-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; text-transform: uppercase; color: white; }
        .admin-btn { border: none; background: none; font-size: 1.5rem; color: #999; cursor: pointer; }
        .admin-btn:hover { color: var(--app-color); }
        .reset-link { font-size: 0.8rem; color: white; background: red; text-decoration: none; cursor: pointer; margin-right: 15px; padding: 5px 10px; border-radius: 4px; font-weight: bold; border: 2px solid darkred; }
        
        .container { flex-grow: 1; max-width: 1000px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        .progress-track { background: #eee; height: 8px; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: var(--app-color); transition: width 0.4s ease; }
        .stage-area { display: none; animation: fadeIn 0.4s; flex-grow: 1; text-align: center; }
        .stage-area.active { display: block; }
        h2.stage-title { font-size: 1.4rem; margin-bottom: 10px; color: #444; }
        p.stage-subtitle { color: #777; margin-bottom: 20px; font-style: italic; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        button.choice-btn { padding: 20px; border: 2px solid transparent; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: all 0.2s; color: #333; }
        button.choice-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .btn-s1 { background: var(--col-1-pink); } .btn-s2 { background: var(--col-2-yellow); } .btn-s3 { background: var(--col-3-blue); } .btn-s4 { background: var(--col-4-green); } .btn-white { background: white; border-color: #ddd; }
        #sentence-builder { margin-top: 20px; padding: 15px; background: #f8f9fa; border: 2px dashed #ccc; border-radius: 8px; min-height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-wrap: wrap; gap: 5px; }
        .fragment { padding: 2px 5px; border-radius: 4px; }
        
        #overlay, #levelup-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; justify-content: center; align-items: center; text-align: center; color: white; }
        #overlay { background: rgba(231, 76, 60, 0.95); } #levelup-overlay { background: rgba(46, 204, 113, 0.95); }
        .shake { animation: shake 0.4s; }
        
        #admin-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center; }
        .admin-panel { background: white; width: 90%; max-width: 900px; height: 90%; border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .panel-header { padding: 15px; background: #eee; display: flex; justify-content: space-between; font-weight: bold; }
        .panel-body { padding: 20px; overflow-y: auto; flex-grow: 1; }
        .section-box { border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .section-title { font-weight: bold; margin-bottom: 10px; display: block; color: var(--app-color); text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .admin-input { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .del-btn { background: #ffdddd; border: 1px solid #ffaaaa; color: red; cursor: pointer; padding: 0 10px; border-radius: 4px; }
        .toggle-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; background: #eef; padding: 10px; border-radius: 5px; }
        .scaffold-row { display: grid; grid-template-columns: 1fr 2fr; align-items: center; margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .scaffold-label { font-weight: bold; font-size: 0.9rem; color:#444; }
        .scaffold-select { padding: 5px; width: 100%; border: 1px solid #999; border-radius: 4px; background: white; }
        #worksheet-area { display: none; }
        @media print {
            body { background: white; padding: 0; height: auto; overflow: visible; display: block; }
            header, .container, #admin-modal, #overlay, #levelup-overlay, #error-trap { display: none !important; }
            #worksheet-area { display: block; font-family: 'Aptos', sans-serif; color: black; }
            .ws-page { page-break-after: always; padding: 40px; }
            .ws-header { text-align: left; border-bottom: 2px solid black; margin-bottom: 30px; padding-bottom: 10px; }
            .ws-title { font-size: 14pt; font-weight: bold; margin-bottom: 5px; font-family: 'Aptos', sans-serif; }
            .ws-instruction { font-size: 11pt; margin-bottom: 20px; font-family: 'Aptos', sans-serif; }
            .ws-gap-fill { line-height: 2.5; font-size: 11pt; margin-bottom: 20px; font-family: 'Aptos', sans-serif; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            td { padding: 15px; vertical-align: middle; }
        }
    </style>
</head>
<body>

    <div id="error-trap">
        <h1>âš  Something went wrong</h1>
        <p id="error-msg">Loading Error.</p>
        <button onclick="localStorage.removeItem('eval_arch_v35'); location.reload();" 
                style="margin-top:20px; padding:15px; background:white; color:red; border:none; font-weight:bold; cursor:pointer;">
            FACTORY RESET APP
        </button>
    </div>

    <script id="app-config" type="application/json">
    {
        "appTitle": "Evaluation Architect",
        "adminPass": "teacher",
        "settings": { "startLevel": 1, "maxLevel": 3, "streakThreshold": 3 },
