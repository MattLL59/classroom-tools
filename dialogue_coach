<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dialogue Coach Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better readability and mobile experience */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .container {
            max-width: 800px;
        }
        .feedback-area {
            min-height: 50px;
            transition: all 0.3s ease;
        }
        textarea {
            min-height: 400px;
            resize: vertical;
        }
        /* Style for the 'error' text (simulating the app's nudges) */
        .nudge {
            background-color: #fef2f2; /* Light Red */
            border-left: 4px solid #ef4444; /* Red Border */
            color: #b91c1c; /* Dark Red Text */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="container mx-auto bg-white p-6 rounded-xl shadow-2xl">
        <header class="mb-6">
            <h1 class="text-3xl font-extrabold text-blue-800">Dialogue Coach Toolkit</h1>
            <p class="text-gray-600 mt-2">Practice dialogue rules in real-time. This tool checks for common punctuation and paragraphing errors.</p>
        </header>

        <!-- Writing Area -->
        <div class="mb-6">
            <label for="writing-area" class="block text-lg font-semibold text-gray-700 mb-2">Write Your Dialogue Here:</label>
            <textarea id="writing-area" 
                      class="w-full border-2 border-gray-300 rounded-lg p-4 focus:outline-none focus:ring-4 focus:ring-blue-200"
                      placeholder="Start typing your conversation. Remember: New speaker, new paragraph!"></textarea>
        </div>

        <!-- Feedback Area -->
        <div id="feedback-container" class="feedback-area">
            <!-- Feedback messages will appear here -->
        </div>

        <!-- Educational Reminder Card -->
        <div class="mt-8 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg shadow-md">
            <h3 class="text-xl font-bold text-blue-700">Golden Rule Reminder</h3>
            <p class="text-gray-700 mt-2">
                Every time a **new character speaks**, you must **start a new paragraph**. This makes dialogue easy for the reader to follow.
            </p>
        </div>
    </div>

    <script>
        const writingArea = document.getElementById('writing-area');
        const feedbackContainer = document.getElementById('feedback-container');

        // Debounce function to limit how often we check the text (improves performance)
        function debounce(func, timeout = 300) {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }

        /**
         * The core function that checks the text against pedagogical rules.
         * This function implements the logic discussed for the MVP.
         */
        function checkDialogueRules(text) {
            let feedbackMessages = [];
            const lines = text.split('\n');
            const dialogueTagRegex = /\b(said|asked|replied|whispered|shouted|insisted|muttered|yelled)\b/i;

            // --- RULE 1: Punctuation Inside Quotes ---
            // Finds instances of a closing quote preceded by a period, where a dialogue tag follows.
            // e.g., "I'm leaving." he said
            const punctuationErrorRegex = /"\.(?=\s*\b(said|asked|replied|whispered|shouted|insisted|muttered|yelled)\b)/gi;
            if (punctuationErrorRegex.test(text)) {
                feedbackMessages.push(
                    `
                    <div class="nudge">
                        **Punctuation Check!** You used a period (".") inside the quotes followed by a tag (like 'he said').
                        <br>
                        **Fix:** Use a **comma (",")** before the closing quote when a dialogue tag follows. 
                        <br>
                        *Example: "I'm leaving<span class="font-black text-red-600">,</span>" she said.*
                    </div>
                    `
                );
            }

            // --- RULE 2: New Speaker, New Paragraph ---
            // Checks for two consecutive non-empty lines, both containing dialogue tags.
            let previousLineWasDialogue = false;
            let currentSpeakerDialogueCount = 0;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                const nextLine = (i + 1 < lines.length) ? lines[i + 1].trim() : '';

                if (line.length === 0) {
                    // Reset if there is a blank line (paragraph break)
                    previousLineWasDialogue = false;
                    currentSpeakerDialogueCount = 0;
                    continue;
                }

                const lineIsDialogue = dialogueTagRegex.test(line) || (line.startsWith('"') && line.endsWith('"'));
                
                if (lineIsDialogue) {
                    currentSpeakerDialogueCount++;

                    // Check for new speaker/new paragraph rule
                    if (previousLineWasDialogue && dialogueTagRegex.test(nextLine) && nextLine.length > 0) {
                        // This triggers if the previous line was dialogue, the current line is a non-empty
                        // dialogue line, and there was no empty line (paragraph break) between them.
                        feedbackMessages.push(
                            `
                            <div class="nudge">
                                **Paragraph Break Nudge!** A new character has likely started speaking near line ${i + 1}.
                                <br>
                                **Fix:** Always press **Enter twice** to start a fresh paragraph when a different character takes their turn.
                                <br>
                                *Rule: New speaker = New paragraph.*
                            </div>
                            `
                        );
                        // Only show this once per contiguous block of errors
                        previousLineWasDialogue = false; 
                    } else if (lineIsDialogue) {
                        previousLineWasDialogue = true;
                    }

                } else {
                    // If the line is narrative, reset the previous dialogue check
                    previousLineWasDialogue = false;
                }

            }
            
            // --- Display Feedback ---
            if (feedbackMessages.length > 0) {
                // Use a Set to ensure unique messages are displayed
                const uniqueMessages = Array.from(new Set(feedbackMessages));
                feedbackContainer.innerHTML = uniqueMessages.join('');
            } else if (text.length > 50) {
                 feedbackContainer.innerHTML = '<div class="p-3 mt-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded-lg font-semibold">âœ… Looking good! You seem to be following the basic rules of dialogue structure.</div>';
            } else {
                feedbackContainer.innerHTML = '';
            }
        }

        // Attach the debounced checker to the input event
        writingArea.addEventListener('input', debounce(() => {
            checkDialogueRules(writingArea.value);
        }, 500));

        // Initial check on load
        checkDialogueRules(writingArea.value);
    </script>
</body>
</html>
